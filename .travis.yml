language: cpp
compiler:
  - gcc
before_install:
# not using OpenCV 2.4.7.exe as it does not include mingw libs
  - OPENCVEXE=OpenCV-2.4.6.0.exe
  - wget -O $OPENCVEXE.7z http://sourceforge.net/projects/opencvlibrary/files/opencv-win/2.4.6/$OPENCVEXE/download
  - wget ftp://mirrors.kernel.org/sourceware/cygwin/x86/release/boost/libboost1.53/libboost1.53-1.53.0-2.tar.bz2
  - wget ftp://mirrors.kernel.org/sourceware/cygwin/x86/release/boost/libboost-devel/libboost-devel-1.53.0-2.tar.bz2
# will probably need other libraries
  - sudo apt-get install p7zip
install:
  - sudo apt-get update
  - sudo apt-get install mingw32
  - pushd .
  - TBZ2DIR=`pwd`
  - cd /usr/i586-mingw32msvc/
  - sudo tar jxf $TBZ2DIR/libboost1.53-*.tar.bz2
  - sudo tar jxf $TBZ2DIR/libboost-devel-*.tar.bz2
  # boost needs cygwin1.dll from ftp://mirrors.kernel.org/sourceware/cygwin/x86/release/cygwin/cygwin-1.7.25-1.tar.bz2
  # and cyggcc_s-1.dll from ftp://mirrors.kernel.org/sourceware/cygwin/x86/release/gcc/libgcc1/libgcc1-4.7.3-1.tar.bz2
  # and cygstdc++-6.dll from ftp://mirrors.kernel.org/sourceware/cygwin/x86/release/gcc/libstdc++6/libstdc++6-4.7.3-1.tar.bz2
  # opencv needs libgcc_s_dw2-1.dll from mingw which can be found here: http://sourceforge.net/projects/mingw/files/MinGW/Base/gcc/Version4/gcc-4.8.1-4/gcc-core-4.8.1-4-mingw32-dll.tar.lzma/download
  # when using gcc<4.5 you might need libstdc++.dll from here: http://sourceforge.net/projects/mingw/files/MinGW/Base/gcc/Version4/gcc-4.8.1-4/gcc-c%2B%2B-4.8.1-4-mingw32-dll.tar.lzma/download
  - popd
  - p7zip -d $OPENCVEXE.7z
  # copy opencv in to single location
  - mkdir cv
  - cp -rf opencv/build/include/ cv/
  - cp -rf opencv/build/x86/mingw/* cv/
  - cp cv/lib/OpenCVConfig.cmake cv/
  # fix permissions
  - sudo chmod a+rx -R cv/
  - pwd
before_script:
# This is the path to the installed OpenCVConfig.cmake
  - mkdir build && cd build
  - pwd
  - cmake .. -DCMAKE_TOOLCHAIN_FILE=../mingw32-cross-compile.cmake -DOpenCV_DIR=../cv/
script: 
  - make
  - cpack -G TGZ
after_success:
  - echo 